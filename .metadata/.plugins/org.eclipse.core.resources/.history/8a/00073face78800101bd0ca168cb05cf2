<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>Expenditure & Returns Report</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>

  <style>
    .page-header { margin-bottom: .75rem; }

    /* Print only the table area */
    @media print {
      body * { visibility: hidden; }
      #printArea, #printArea * { visibility: visible; }
      #printArea { position: absolute; left: 0; top: 0; width: 100%; }
      .no-print { display: none !important; }

      thead { display: table-header-group; }
      tfoot { display: table-footer-group; }

      table { page-break-inside: auto; }
      tr { page-break-inside: avoid; page-break-after: auto; }

      .table td, .table th { padding: .35rem .5rem; }
    }
  </style>
</head>
<body style="background:#f6f8fa; margin:0; padding:0;">

<%@ include file="nav.jsp" %>

<div class="container py-4">

  <!-- Month name without using functions taglib -->
  <c:set var="monthName" value="" />
  <c:if test="${selectedMonth == 1}"><c:set var="monthName" value="January"/></c:if>
  <c:if test="${selectedMonth == 2}"><c:set var="monthName" value="February"/></c:if>
  <c:if test="${selectedMonth == 3}"><c:set var="monthName" value="March"/></c:if>
  <c:if test="${selectedMonth == 4}"><c:set var="monthName" value="April"/></c:if>
  <c:if test="${selectedMonth == 5}"><c:set var="monthName" value="May"/></c:if>
  <c:if test="${selectedMonth == 6}"><c:set var="monthName" value="June"/></c:if>
  <c:if test="${selectedMonth == 7}"><c:set var="monthName" value="July"/></c:if>
  <c:if test="${selectedMonth == 8}"><c:set var="monthName" value="August"/></c:if>
  <c:if test="${selectedMonth == 9}"><c:set var="monthName" value="September"/></c:if>
  <c:if test="${selectedMonth == 10}"><c:set var="monthName" value="October"/></c:if>
  <c:if test="${selectedMonth == 11}"><c:set var="monthName" value="November"/></c:if>
  <c:if test="${selectedMonth == 12}"><c:set var="monthName" value="December"/></c:if>

  <!-- Heading -->
  <div class="page-header" padding-top="15rem" padding-bottom="0.5rem">
    <h2 class="mb-1">Expenditure & Returns Report (${reportType})</h2>
    <div class="text-muted">
      <c:choose>
        <c:when test="${reportType == 'Monthly'}">
          For <strong>${monthName}</strong>, <strong>${selectedYear}</strong>
        </c:when>
        <c:otherwise>
          For Year <strong>${selectedYear}</strong>
        </c:otherwise>
      </c:choose>
    </div>
  </div>

  <!-- Filters row -->
  <form class="row g-2 mb-4 no-print" method="get" action="${pageContext.request.contextPath}/report">
    <div class="col-auto">
      <label for="month" class="form-label mb-0">Month</label>
      <select id="month" name="month" class="form-select">
        <c:forEach var="i" begin="1" end="12">
          <option value="${i}" <c:if test="${i == selectedMonth}">selected</c:if>>${i}</option>
        </c:forEach>
      </select>
    </div>

    <div class="col-auto">
      <label for="year" class="form-label mb-0">Year</label>
      <select id="year" name="year" class="form-select">
        <c:forEach var="y" begin="2024" end="2030">
          <option value="${y}" <c:if test="${y == selectedYear}">selected</c:if>>${y}</option>
        </c:forEach>
      </select>
    </div>

    <div class="col-auto">
      <label for="type" class="form-label mb-0">Report Type</label>
      <select id="type" name="type" class="form-select">
        <option value="monthly" <c:if test="${reportType == 'Monthly'}">selected</c:if>>Monthly</option>
        <option value="yearly"  <c:if test="${reportType == 'Yearly'}">selected</c:if>>Yearly</option>
      </select>
    </div>

    <div class="col-auto d-flex align-items-end">
      <button type="submit" class="btn btn-primary">Show Report</button>
    </div>
  </form>

  <!-- PRINTABLE AREA -->
  <div id="printArea">
    <div class="mb-2">
      <h5 class="mb-0">Expenditure & Returns Report (${reportType})</h5>
      <small class="text-muted">
        <c:choose>
          <c:when test="${reportType == 'Monthly'}">
            For ${monthName}, ${selectedYear}
          </c:when>
          <c:otherwise>
            For Year ${selectedYear}
          </c:otherwise>
        </c:choose>
      </small>
    </div>

    <div class="table-responsive">
      <table class="table table-bordered table-hover">
        <thead class="table-light">
          <tr>
            <th>Date</th>
            <th>Customer Name</th>
            <th>Final Price</th>
            <th>Received Amount</th>
            <th>Balance Amount</th>
          </tr>
        </thead>
        <tbody>
          <c:forEach var="row" items="${entries}">
            <tr>
              <td>${row[0]}</td>
              <td>${row[1]}</td>
              <td>${row[2]}</td>
              <td>${row[3]}</td>
              <td>${row[4]}</td>
            </tr>
          </c:forEach>
        </tbody>
        <tfoot>
          <tr class="table-info">
            <th colspan="2">Total</th>
            <th>${totalFinal}</th>
            <th>${totalReceived}</th>
            <th>${totalBalance}</th>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>

  <!-- Print button -->
  <div class="d-flex justify-content-center align-items-center mt-3 no-print">
    <button type="button" class="btn btn-success" onclick="window.print()">Print</button>
  </div>
</div>

</body>
</html>
