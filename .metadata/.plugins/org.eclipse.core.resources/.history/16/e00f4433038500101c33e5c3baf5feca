<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>Manage Vans</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet"/>
</head>
<body class="bg-light">
<%@ include file="nav.jsp" %>
<div class="container mt-4">

  <!-- Back -->
<!--  <div class="d-flex justify-content-start mb-3">
    <a href="${pageContext.request.contextPath}/dashboard" class="btn btn-outline-secondary">
      <i class="bi bi-arrow-left"></i> Back
    </a>
  </div>-->

  <h2 class="mb-3">Manage Vans</h2>

  <!-- Add Van -->
  <form action="${pageContext.request.contextPath}/vans/save" method="post"
        class="card p-4 mb-4 shadow-sm bg-white">
    <div class="row g-3">
      <div class="col-md-4">
        <label class="form-label">Registration No</label>
        <input type="text" name="regNo" class="form-control" required/>
      </div>
      <div class="col-md-4">
        <label class="form-label">Model</label>
        <input type="text" name="model" class="form-control"/>
      </div>
      <div class="col-md-4">
        <label class="form-label">Status</label>
        <select name="status" class="form-select" required>
          <option value="">Select Status</option>
          <option value="Active">Active</option>
          <option value="Service">Service</option>
          <option value="Inactive">Inactive</option>
        </select>
      </div>
      <div class="col-12 text-end">
        <button class="btn btn-primary" type="submit">Save</button>
        <button class="btn btn-secondary ms-2" type="reset">Clear</button>
      </div>
    </div>
  </form>

  <!-- Vans Table -->
  <table class="table table-bordered table-hover bg-white shadow-sm align-middle">
    <thead class="table-dark">
    <tr>
      <th style="width:80px">ID</th>
      <th>Reg No</th>
      <th>Model</th>
      <th>Status</th>
      <th style="width:240px">Action</th>
    </tr>
    </thead>
    <tbody>
    <c:forEach var="v" items="${vans}">
      <tr>
        <td>${v.id}</td>
        <td>${v.regNo}</td>
        <td>${v.model}</td>
        <td>${v.status}</td>
        <td class="d-flex gap-1">
          <button class="btn btn-sm btn-outline-primary p-1"
                  onclick="editVan('${v.id}','${v.regNo}','${v.model}','${v.status}')" title="Edit">
            <i class="bi bi-pencil"></i>
          </button>
          <a class="btn btn-sm btn-outline-danger p-1"
             href="${pageContext.request.contextPath}/vans/delete/${v.id}"
             onclick="return confirm('Delete this van?');" title="Delete">
            <i class="bi bi-trash"></i>
          </a>
        </td>
      </tr>
    </c:forEach>
    </tbody>
  </table>
</div>

<!-- Edit Modal -->
<div class="modal fade" id="editModal" tabindex="-1">
  <div class="modal-dialog">
    <form class="modal-content"
          action="${pageContext.request.contextPath}/vans/save"
          method="post">
      <div class="modal-header">
        <h5 class="modal-title">Edit Van</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body row g-3 px-3">
        <!-- Hidden ID so save() will update (id present) -->
        <input type="hidden" id="editId" name="id"/>

        <div class="col-12">
          <label class="form-label">Registration No</label>
          <input type="text" id="editRegNo" name="regNo" class="form-control" required/>
        </div>

        <div class="col-12">
          <label class="form-label">Model</label>
          <input type="text" id="editModel" name="model" class="form-control"/>
        </div>

        <div class="col-12">
          <label class="form-label">Status</label>
          <select id="editStatus" name="status" class="form-select" required>
            <option value="Active">Active</option>
            <option value="Service">Service</option>
            <option value="Inactive">Inactive</option>
          </select>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-success" type="submit">Update</button>
        <button class="btn btn-secondary" type="button" data-bs-dismiss="modal">Close</button>
      </div>
    </form>
  </div>
</div>

<!-- View Modal -->
<div class="modal fade" id="viewModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content p-3">
      <div class="modal-header">
        <h5 class="modal-title">Van Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p><strong>ID:</strong> <span id="vId"></span></p>
        <p><strong>Reg No:</strong> <span id="vRegNo"></span></p>
        <p><strong>Model:</strong> <span id="vModel"></span></p>
        <p><strong>Status:</strong> <span id="vStatus"></span></p>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  function viewVan(id, regNo, model, status) {
    document.getElementById('vId').innerText = id;
    document.getElementById('vRegNo').innerText = regNo;
    document.getElementById('vModel').innerText = model;
    document.getElementById('vStatus').innerText = status;
    new bootstrap.Modal(document.getElementById('viewModal')).show();
  }

  function editVan(id, regNo, model, status) {
    document.getElementById('editId').value = id;
    document.getElementById('editRegNo').value = regNo;
    document.getElementById('editModel').value = model;
    document.getElementById('editStatus').value = status;
    new bootstrap.Modal(document.getElementById('editModal')).show();
  }
</script>
</body>
</html>